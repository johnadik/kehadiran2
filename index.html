<!DOCTYPE html>
<html>
<head>
  <title>Form Kehadiran</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script>
    async function semakID() {
      const idStaf = document.getElementById("idStaf").value;
      const response = await fetch("https://script.google.com/macros/s/AKfycbx8nUP6y4kc6iaPjBeSAfjkTUIvrbrNbsb5uektdRF3koL_QE6inH3hmUJxGvRPTptf/exec", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "semakID", idStaf: idStaf }),
      });
      const result = await response.json();
      if (result.status === "success") {
        document.getElementById("nama").innerText = result.nama;
        document.getElementById("jawatan").innerText = result.jawatan;
        document.getElementById("lokasi").innerText = result.lokasi;
        alert("Maklumat staf ditemui!");
      } else {
        alert("ID Staf tidak ditemui.");
      }
    }

    async function rekodKehadiran() {
      const idStaf = document.getElementById("idStaf").value;
      const nama = document.getElementById("nama").innerText;
      const jenis = "HADIR"; // Anda boleh ubah mengikut keperluan
      const response = await fetch("https://script.google.com/macros/s/AKfycbx8nUP6y4kc6iaPjBeSAfjkTUIvrbrNbsb5uektdRF3koL_QE6inH3hmUJxGvRPTptf/exec", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "rekodKehadiran", idStaf: idStaf, nama: nama, jenis: jenis }),
      });
      const result = await response.text();
      alert(result);
    }
  </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            position: relative;
            min-height: 100vh;
        }
        .background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            opacity: 0.15;
        }
        .card {
            border: none;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background-color: rgba(255, 255, 255, 0.95);
        }
        .form-container {
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        .image-container {
            max-width: 500px;
            margin: 0 auto 2rem auto;
            text-align: center;
            position: relative;
            z-index: 1;

        }
        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 150px; /* Lebar gambar */
            height: auto; /* Tinggi otomatis agar proporsional */
        }
        .form-control {
            border-radius: 8px;
            padding: 12px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        .form-control:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.15);
        }
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background-color: #0d6efd;
            border: none;
        }
        .btn-primary:hover {
            background-color: #0b5ed7;
            transform: translateY(-1px);
        }
        .btn-success {
            background-color: #198754;
            border: none;
        }
        .btn-success:hover {
            background-color: #157347;
            transform: translateY(-1px);
        }
        .modal-content {
            border-radius: 16px;
            border: none;
        }
        .modal-header {
            border-bottom: 1px solid #e9ecef;
            padding: 1.5rem;
        }
        .modal-body {
            padding: 1.5rem;
        }
        .info-label {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        .info-value {
            font-size: 1.1rem;
            font-weight: 500;
            color: #212529;
        }
        .page-title {
            color: #212529;
            font-weight: 600;
            margin-bottom: 2rem;
        }
        .form-label {
            font-weight: 500;
            color: #495057;
        }
        .alert {
            border-radius: 8px;
            padding: 1rem;
        }
        .loading-container {
            display: none;
            margin-top: 1rem;
        }
        .progress {
            height: 8px;
            border-radius: 4px;
            background-color: #e9ecef;
            overflow: hidden;
        }
        .progress-bar {
            background-color: #0d6efd;
            width: 0%;
            transition: width 0.3s ease;
            animation: progress-animation 1s infinite;
        }
        @keyframes progress-animation {
            0% {
                width: 0%;
            }
            50% {
                width: 70%;
            }
            100% {
                width: 100%;
            }
        }
        .loading-text {
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .grey-text {
          color: grey;
          font-weight: bold;
          font-size: 16px; /* Ukuran font */
        }

        /* Gaya untuk floating bar */
        .floating-bar {
        position: fixed; /* Tetap di posisi layar */
        bottom: 0; /* Di bagian bawah */
        left: 0; /* Mulai dari kiri */
        width: 100%; /* Lebar penuh */
        background-color: #f1f1f1; /* Warna latar belakang */
        color: #333; /* Warna teks */
        text-align: center; /* Pusatkan teks */
        padding: 2px 0; /* Ruang atas dan bawah */
        font-size: 9px; /* Ukuran font */
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1); /* Bayangan halus */
        z-index: 1000; /* Pastikan selalu di atas elemen lain */
        }

        .image-thankyou {
            width: 150px; /* Lebar gambar */
            height: auto; /* Tinggi otomatis agar proporsional */
        }

    </style>
</head>
<body>
    <!-- Background image -->
    <img src="https://www.graphicpear.com/wp-content/uploads/2022/10/Abstract-Geometric-3D-Seamless-Pattern--1260x908.png" alt="Background" class="background-image">
    
    <div class="container mt-5">
      <!-- Top image -->
      <div class="image-container">
        <img src="https://images.seeklogo.com/logo-png/40/1/felcra-berhad-logo-png_seeklogo-408372.png" alt="Header Image">
      </div>
        
        <div class="form-container">
            <div class="card p-4">
                <h2 class="page-title text-center">Form Kehadiran</h2>
                <div class="mb-4">
                    <label for="idStaf" class="form-label">Masukkan ID STAF</label>
                    <div class="input-group">
                        <input type="number" id="idStaf" class="form-control" placeholder="Contoh: 1234">
                        <button class="btn btn-primary" onclick="semakID()" id="semakButton">
                            <span>SEMAK</span>
                        </button>
                    </div>
                </div>
                <div class="loading-container" id="loadingContainer">
                    <div class="progress">
                        <div class="progress-bar"></div>
                    </div>
                    <div class="loading-text">Menyemak ID STAF...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Bootstrap for Staff Info -->
    <div class="modal fade" id="infoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Maklumat Staf</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <div class="info-label">Nama</div>
                        <div class="info-value" id="namaStaf"></div>
                    </div>
                    <div class="mb-3">
                        <div class="info-label">Jawatan</div>
                        <div class="info-value" id="jawatan"></div>
                    </div>
                    <div class="mb-3">
                        <div class="info-label">Lokasi</div>
                        <div class="info-value" id="lokasi"></div>
                    </div>
                    <div id="kehadiranBtns" class="text-center mt-4"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Modal for Thank You Message -->
    <div class="modal fade" id="thankYouModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center p-5">
                    <img src="https://images.seeklogo.com/logo-png/40/1/felcra-berhad-logo-png_seeklogo-408372.png" alt="Header Image" 
                class="image-thankyou" >
                    <h4 class="mb-4">TERIMA KASIH KERANA HADIR</h4>
                    <h5 class="mb-4">MAJLIS AMANAT CEO 2025</h5>
                    <button class="btn btn-secondary btn-lg w-100" hidden onclick="location.reload()">KEMBALI</button>
                </div>
            </div>
        </div>
    </div>

        <!-- Floating Bar -->
        <div class="floating-bar">
          Sponsorship by <a href="https://felcra.com.my/" target="_blank" style="color: #007BFF; text-decoration: none;">WayJaz Custom Design</a>
        </div>

    <script>
        function semakID() {
            const idStaf = document.getElementById("idStaf").value;
            if (!idStaf) {
                showAlert("Sila masukkan ID STAF", "warning");
                return;
            }

            // Show loading bar and disable button
            const loadingContainer = document.getElementById("loadingContainer");
            const semakButton = document.getElementById("semakButton");
            loadingContainer.style.display = "block";
            semakButton.disabled = true;

            google.script.run
                .withSuccessHandler((data) => {
                    // Hide loading bar and enable button
                    loadingContainer.style.display = "none";
                    semakButton.disabled = false;
                    paparMaklumat(data);
                })
                .withFailureHandler(() => {
                    // Hide loading bar and enable button
                    loadingContainer.style.display = "none";
                    semakButton.disabled = false;
                    showAlert("Ralat semasa menyemak ID STAF", "danger");
                })
                .semakID(idStaf);
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement("div");
            alertDiv.className = `alert alert-${type} alert-dismissible fade show mt-3`;
            alertDiv.innerHTML = `
                <span style="white-space: pre-line;">${message}</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.querySelector(".form-container").appendChild(alertDiv);
            setTimeout(() => alertDiv.remove(), 3000);
        }

        function paparMaklumat(data) {
            if (data.status === "not_found") {
                showAlert("ID STAF tidak ditemui!", "danger");
                return;
            }

            document.getElementById("namaStaf").innerText = data.nama;
            document.getElementById("jawatan").innerText = data.jawatan;
            document.getElementById("lokasi").innerText = data.lokasi;

            const kehadiranBtns = document.getElementById("kehadiranBtns");
            kehadiranBtns.innerHTML = "";

            const btn = document.createElement("button");
            btn.className = "btn btn-success btn-lg w-100";
            btn.innerText = data.dalamJemputan ? "HADIR" : "WAKIL";
            btn.onclick = function() { rekodKehadiran(data.nama, btn.innerText); };
            kehadiranBtns.appendChild(btn);

            const modal = new bootstrap.Modal(document.getElementById("infoModal"));
            modal.show();
        }

        function rekodKehadiran(idStaf, nama, jenis) {
            document.getElementById("kehadiranBtns").innerHTML = "<p><span class='grey-text'>Sedang merekod...</span></p>";

            google.script.run.withSuccessHandler(() => {
                const infoModal = bootstrap.Modal.getInstance(document.getElementById("infoModal"));
                infoModal.hide();

                const audio = new Audio("https://www.myinstants.com/media/sounds/tink.mp3");
                audio.play();

                // Show thank you modal instead of alert
                const thankYouModal = new bootstrap.Modal(document.getElementById("thankYouModal"));
                thankYouModal.show();
            }).rekodKehadiran(idStaf, nama, jenis);
        }

        // Add input validation
        document.getElementById("idStaf").addEventListener("input", function(e) {
            this.value = this.value.toUpperCase();
        });

        // Add enter key support
        document.getElementById("idStaf").addEventListener("keypress", function(e) {
            if (e.key === "Enter") {
                semakID();
            }
        });
    </script>
</body>
</html>
